(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[905],{46733:function(e,t,s){Promise.resolve().then(s.bind(s,76713))},76713:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return u}});var a=s(3827),n=s(64090),l=s(86782),d=s(56288),c=s(47907);let i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";switch(e.toLowerCase()){case"delivered":return"bg-green-100 text-green-700";case"read":return"bg-violet-100 text-violet-700";case"sent":return"bg-blue-100 text-blue-700";case"failed":return"bg-red-100 text-red-700";case"processing":return"bg-yellow-100 text-yellow-800";case"scheduled":return"bg-blue-50 text-blue-700";case"completed":return"bg-green-50 text-green-700";default:return"bg-gray-100 text-gray-700"}},r={_id:"mock-campaign-1",name:"Diwali offer",template:"welcome",audience:"new",schedule:"2025-12-08T20:45:00Z",status:"scheduled",stats:{sent:120,delivered:98,failed:3,read:50}},o=Array.from({length:20}).map((e,t)=>({_id:"c-".concat(t),name:"Contact ".concat(t+1),phone:"91".concat(9e8+t),status:t%7==0?"failed":t%3==0?"delivered":"sent",lastUpdate:new Date(Date.now()-18e5*t).toISOString()}));function h(e){let{slices:t=[]}=e,s=t.reduce((e,t)=>e+(t.value||0),0)||1,n=0;return(0,a.jsx)("svg",{width:"96",height:"96",viewBox:"0 0 32 32",children:t.map((e,t)=>{let l=e.value/s*360,d=m(16,16,16,n),c=m(16,16,16,n+l),i="M ".concat(16," ").concat(16," L ").concat(d.x," ").concat(d.y," A ").concat(16," ").concat(16," 0 ").concat(l>180?1:0," 1 ").concat(c.x," ").concat(c.y," Z");return n+=l,(0,a.jsx)("path",{d:i,fill:e.color,stroke:"white",strokeWidth:"0.2"},t)})})}function m(e,t,s,a){let n=(a-90)*Math.PI/180;return{x:e+s*Math.cos(n),y:t+s*Math.sin(n)}}function u(e){let{params:t}=e,s=(null==t?void 0:t.id)||new URLSearchParams(window.location.search).get("id");(0,c.useRouter)();let[m,u]=(0,n.useState)(null),[x,g]=(0,n.useState)([]),[p,v]=(0,n.useState)(!0),[j,b]=(0,n.useState)(!1),f=async()=>{v(!0);try{let e=await fetch("/api/campaigns/".concat(s));u(e.ok?await e.json():r)}catch(e){u(r)}try{let e=await fetch("/api/campaigns/".concat(s,"/contacts"));g(e.ok?await e.json():o)}catch(e){g(o)}v(!1)};(0,n.useEffect)(()=>{f();let e=(0,l.io)(window.location.origin,{transports:["websocket"]});return e.on("campaign_update",e=>{e&&e.campaignId===(s||r._id)&&(e.stats&&u(t=>t?{...t,stats:{...t.stats,...e.stats}}:t),e.contactId&&g(t=>t.map(t=>t._id===e.contactId?{...t,status:e.status,lastUpdate:new Date().toISOString()}:t)),e.status&&u(t=>t?{...t,status:e.status}:t))}),()=>{e.disconnect()}},[s]);let y=(0,n.useMemo)(()=>{var e,t,s,a;let n=(null==m?void 0:m.stats)||{},l=null!==(e=n.sent)&&void 0!==e?e:x.filter(e=>"pending"!==e.status).length,d=null!==(t=n.delivered)&&void 0!==t?t:x.filter(e=>"delivered"===e.status).length,c=null!==(s=n.failed)&&void 0!==s?s:x.filter(e=>"failed"===e.status).length,i=null!==(a=n.read)&&void 0!==a?a:x.filter(e=>"read"===e.status).length,r=x.length-l;return{totalSent:l,delivered:d,failed:c,read:i,pending:r}},[m,x]),w=async()=>{if(confirm("Send this campaign now?")){b(!0);try{let e=await fetch("/api/campaigns/".concat(s,"/send"),{method:"POST"});if(!e.ok)throw Error();d.Am.success("Send triggered"),u((await e.json()).campaign)}catch(e){d.Am.success("Send simulated"),u(e=>e?{...e,status:"processing"}:e),g(e=>e.map((e,t)=>({...e,status:t%5==0?"failed":"sent",lastUpdate:new Date().toISOString()})))}b(!1)}};return p?(0,a.jsxs)("div",{className:"p-6 space-y-4",children:[(0,a.jsx)("div",{className:"animate-pulse h-6 bg-gray-200 w-48 rounded"}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,a.jsx)("div",{className:"animate-pulse h-28 bg-gray-100 rounded"}),(0,a.jsx)("div",{className:"animate-pulse h-28 bg-gray-100 rounded"}),(0,a.jsx)("div",{className:"animate-pulse h-28 bg-gray-100 rounded"})]})]}):(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold",children:null==m?void 0:m.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:["Template: ",(0,a.jsx)("b",{children:null==m?void 0:m.template})," • Audience:"," ",(0,a.jsx)("b",{children:null==m?void 0:m.audience})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(i(null==m?void 0:m.status)),children:null==m?void 0:m.status}),(0,a.jsx)("button",{onClick:()=>{let e=["name,phone,status,lastUpdate",...x.map(e=>'"'.concat(e.name,'","').concat(e.phone,'","').concat(e.status,'","').concat(e.lastUpdate||"",'"'))].join("\n"),t=new Blob([e],{type:"text/csv"}),s=document.createElement("a");s.href=URL.createObjectURL(t),s.download="".concat((null==m?void 0:m.name)||"campaign","_contacts.csv"),s.click()},className:"px-3 py-2 bg-gray-100 rounded-md text-sm hover:bg-gray-200",children:"Export CSV"}),(0,a.jsx)("button",{onClick:w,disabled:j,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-60",children:j?"Sending...":"Send Now"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm border",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Total Sent"}),(0,a.jsx)("div",{className:"text-2xl font-semibold",children:y.totalSent})]}),(0,a.jsx)(h,{slices:[{value:y.delivered,color:"#10B981"},{value:y.failed,color:"#EF4444"},{value:y.totalSent-y.delivered-y.failed,color:"#3B82F6"}]})]}),(0,a.jsxs)("div",{className:"mt-3 text-sm text-gray-600 space-y-1",children:[(0,a.jsxs)("div",{children:["Delivered: ",(0,a.jsx)("b",{children:y.delivered})]}),(0,a.jsxs)("div",{children:["Failed: ",(0,a.jsx)("b",{children:y.failed})]}),(0,a.jsxs)("div",{children:["Read: ",(0,a.jsx)("b",{children:y.read})]})]})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm border",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Progress"}),(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("div",{className:"w-full bg-gray-100 rounded-full h-3 overflow-hidden",children:(0,a.jsx)("div",{style:{width:"".concat(Math.round(y.delivered/Math.max(1,y.totalSent)*100),"%")},className:"h-3 bg-green-500"})}),(0,a.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:["Delivered ",y.delivered," • Pending"," ",y.pending]})]})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm border",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Schedule"}),(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("div",{className:"text-lg font-medium",children:(null==m?void 0:m.schedule)?new Date(m.schedule).toLocaleString():"Not scheduled"}),(0,a.jsxs)("div",{className:"mt-1 text-sm text-gray-600",children:["Created:"," ",(null==m?void 0:m.createdAt)?new Date(m.createdAt).toLocaleString():"—"]})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:[(0,a.jsxs)("div",{className:"p-4 border-b flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-semibold",children:["Contacts (",x.length,")"]}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Delivery status and recent updates"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{placeholder:"Search by name / phone",onChange:e=>{let t=e.target.value.trim().toLowerCase();if(!t)return f();g(e=>e.filter(e=>(e.name+e.phone).toLowerCase().includes(t)))},className:"px-3 py-2 border rounded-md text-sm"}),(0,a.jsx)("button",{onClick:()=>{f(),d.Am.success("Refreshed")},className:"px-3 py-2 bg-gray-100 rounded-md hover:bg-gray-200",children:"Refresh"})]})]}),(0,a.jsx)("div",{className:"p-4 max-h-[48vh] overflow-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"text-left text-sm text-gray-500",children:[(0,a.jsx)("th",{children:"Name"}),(0,a.jsx)("th",{children:"Phone"}),(0,a.jsx)("th",{children:"Status"}),(0,a.jsx)("th",{children:"Last update"}),(0,a.jsx)("th",{children:"Action"})]})}),(0,a.jsxs)("tbody",{children:[x.map(e=>(0,a.jsxs)("tr",{className:"border-b last:border-0",children:[(0,a.jsx)("td",{className:"py-3 font-medium",children:e.name}),(0,a.jsx)("td",{className:"py-3 text-sm text-gray-600",children:e.phone}),(0,a.jsx)("td",{className:"py-3",children:(0,a.jsx)("span",{className:"px-3 py-1 rounded-full text-sm ".concat(i(e.status)),children:e.status})}),(0,a.jsx)("td",{className:"py-3 text-sm text-gray-600",children:e.lastUpdate?new Date(e.lastUpdate).toLocaleString():"—"}),(0,a.jsx)("td",{className:"py-3",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:async()=>{let t="failed"===e.status?"sent":"sent"===e.status?"delivered":e.status;g(s=>s.map(s=>s._id===e._id?{...s,status:t,lastUpdate:new Date().toISOString()}:s));try{await fetch("/api/campaigns/".concat(s,"/contacts/").concat(e._id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:t})})}catch(e){}},className:"px-2 py-1 bg-gray-100 rounded-md text-sm hover:bg-gray-200",children:"Toggle"}),(0,a.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(e.phone),d.Am.success("Phone copied")},className:"px-2 py-1 bg-gray-100 rounded-md text-sm hover:bg-gray-200",children:"Copy"})]})})]},e._id)),0===x.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:5,className:"text-center py-6 text-gray-500",children:"No contacts"})})]})]})})]})]})}}},function(e){e.O(0,[288,254,971,69,744],function(){return e(e.s=46733)}),_N_E=e.O()}]);