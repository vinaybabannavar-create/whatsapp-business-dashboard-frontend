"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[228],{55228:function(e,t,a){a.d(t,{Z:function(){return g}});var r=a(3827),n=a(64090),s=a(58787),l=a(32355),i=a(52235),o=a(80223),c=a(33388),d=a(79990);function u(e){let{onSend:t,onSendFile:a,disabled:s,onTyping:l,onStopTyping:u,replyTo:x,onCancelReply:m}=e,[h,f]=(0,n.useState)(""),p=(0,n.useRef)(null),b=()=>{h.trim()&&(t(h),f(""),u())};return(0,r.jsxs)("div",{className:"border-t bg-white p-3",children:[x&&(0,r.jsxs)("div",{className:"mb-2 p-2 bg-gray-100 border-l-4 border-emerald-500 rounded",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsxs)("p",{className:"text-xs font-semibold",children:["Replying to: ","business"===x.from?"You":"Customer"]}),(0,r.jsx)("button",{onClick:m,children:(0,r.jsx)(i.Z,{size:16})})]}),(0,r.jsx)("p",{className:"text-xs opacity-70 truncate max-w-[250px]",children:x.text||"[media]"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("button",{onClick:()=>{var e;return null===(e=p.current)||void 0===e?void 0:e.click()},className:"p-2 rounded-full hover:bg-gray-200 transition",children:(0,r.jsx)(o.Z,{size:20})}),(0,r.jsx)("input",{type:"file",ref:p,hidden:!0,onChange:e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];r&&(a(r),e.target.value="")}}),(0,r.jsx)("input",{value:h,onKeyDown:e=>{"Enter"===e.key&&h.trim()&&(e.preventDefault(),b())},onChange:e=>{let t=e.target.value;f(t),t.trim().length>0?l():u()},placeholder:"Message...",className:"flex-1 px-4 py-2 bg-gray-100 rounded-full outline-none"}),(0,r.jsx)("button",{className:"p-2 rounded-full hover:bg-gray-200 transition",children:(0,r.jsx)(c.Z,{size:20})}),(0,r.jsx)("button",{onClick:b,disabled:!h.trim()||s,className:"px-4 py-2 rounded-full flex items-center gap-2 font-medium shadow-sm transition ".concat(h.trim()?"bg-emerald-500 hover:bg-emerald-600 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:(0,r.jsx)(d.Z,{size:16})})]})]})}var x=a(65561),m=a(62720),h=a(96399),f=a(28670),p=a(19039),b=a(23441);let v=["❤️","\uD83D\uDE02","\uD83D\uDC4D","\uD83D\uDD25","\uD83D\uDE22"];function g(){let{selectedPhone:e,selectedName:t,clearChat:a}=(0,s.a)(),[i,o]=(0,n.useState)([]),[c,d]=(0,n.useState)(!1),[g,y]=(0,n.useState)(!1),[j,w]=(0,n.useState)(null),[N,S]=(0,n.useState)(!1),[k,D]=(0,n.useState)(!1),[C,_]=(0,n.useState)("dots"),[E,T]=(0,n.useState)(!0),[P,A]=(0,n.useState)(!1),[R,U]=(0,n.useState)(""),[O,I]=(0,n.useState)(null),L=(0,n.useRef)(null),z=(0,n.useRef)(null);function M(e){let t=new Date(e),a=new Date;a.setHours(0,0,0,0),t.setHours(0,0,0,0);let r=(a.getTime()-t.getTime())/864e5;return 0===r?"Today":1===r?"Yesterday":r<7?t.toLocaleDateString("en-US",{weekday:"long"}):t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}let Z=e=>{var t;let a=new Date(e.createdAt).toLocaleString();return"Status: ".concat(null!==(t=e.status)&&void 0!==t?t:"sent"," • ").concat(a)};(0,n.useEffect)(()=>{(async function(){if(!e){o([]);return}d(!0);try{let t=(await (0,l.BJ)(e)||[]).map(e=>{var t,a,r,n;return{...e,_id:null!==(a=null!==(t=e._id)&&void 0!==t?t:e.id)&&void 0!==a?a:String(Math.random()).slice(2),createdAt:"string"==typeof e.createdAt?e.createdAt:"string"==typeof e.time?e.time:new Date().toISOString(),reactions:Array.isArray(e.reactions)?e.reactions:[],deletedForMe:null!==(r=e.deletedForMe)&&void 0!==r&&r,isDeleted:null!==(n=e.isDeleted)&&void 0!==n&&n}});o(t)}catch(e){console.error("Failed to load chat history:",e),o([])}d(!1),w(null),T(!0),A(!1)})()},[e]),(0,n.useEffect)(()=>{if(E){var e;null===(e=L.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}),A(!1)}else i.length>0&&A(!0)},[i,E]);let F=e=>e?"sent"===e?(0,r.jsx)("span",{className:"text-[10px] text-slate-200",children:"✓"}):"delivered"===e?(0,r.jsx)("span",{className:"text-[10px] text-slate-200",children:"✓✓"}):(0,r.jsx)("span",{className:"text-[10px] text-emerald-300 font-bold",children:"✓✓"}):null,J=(e,t)=>{o(a=>a.map(a=>{var r;return a._id===e?{...a,reactions:(null===(r=a.reactions)||void 0===r?void 0:r.includes(t))?a.reactions.filter(e=>e!==t):[...a.reactions||[],t]}:a}))},B=async t=>{var a,r,n,s,i;if(!e)return;let c=Date.now().toString(),d={_id:c,from:"business",text:t,createdAt:new Date().toISOString(),status:"sent",replyToId:null!==(a=null==j?void 0:j._id)&&void 0!==a?a:null};o(e=>[...e,d]),w(null);try{let a=await (0,l.wR)(e,t),d=null!==(n=null!==(r=a._id)&&void 0!==r?r:a.id)&&void 0!==n?n:c,u=null!==(i=null!==(s=a.createdAt)&&void 0!==s?s:a.time)&&void 0!==i?i:new Date().toISOString();o(e=>e.map(e=>{var t,r;return e._id===c?{...e,_id:d,createdAt:u,text:null!==(t=a.text)&&void 0!==t?t:e.text,status:null!==(r=a.status)&&void 0!==r?r:e.status}:e}))}catch(e){console.error("Send failed:",e)}},V=async t=>{var a,r,n,s,i;if(!e)return;let c=Date.now().toString(),d=t.type.startsWith("image")?"image":t.type.startsWith("audio")?"audio":"document",u=URL.createObjectURL(t),x={_id:c,from:"business",text:"",createdAt:new Date().toISOString(),status:"sent",fileUrl:u,fileName:t.name,fileType:d,replyToId:null!==(a=null==j?void 0:j._id)&&void 0!==a?a:null};o(e=>[...e,x]),w(null);try{let a=await (0,l.ij)(e,t),d=null!==(n=null!==(r=a._id)&&void 0!==r?r:a.id)&&void 0!==n?n:c,u=null!==(i=null!==(s=a.createdAt)&&void 0!==s?s:a.time)&&void 0!==i?i:new Date().toISOString();o(e=>e.map(e=>{var t,r,n,s;return e._id===c?{...e,_id:d,createdAt:u,fileUrl:null!==(t=a.fileUrl)&&void 0!==t?t:e.fileUrl,fileName:null!==(r=a.fileName)&&void 0!==r?r:e.fileName,fileType:null!==(n=a.fileType)&&void 0!==n?n:e.fileType,status:null!==(s=a.status)&&void 0!==s?s:e.status}:e}))}catch(e){console.error("File upload failed:",e)}},Y=async t=>{if(e){o(e=>e.map(e=>e._id===t?{...e,deletedForMe:!0,text:"",fileUrl:void 0}:e)),I(null);try{await (0,l.pq)(e,t)}catch(e){console.error("Delete for me failed:",e)}}},H=async t=>{if(e){o(e=>e.map(e=>e._id===t?{...e,isDeleted:!0,text:"",fileUrl:void 0,fileName:void 0,fileType:void 0}:e)),I(null);try{await (0,l.Bv)(e,t)}catch(e){console.error("Delete for everyone failed:",e)}}},q=async()=>{if(e){o([]);try{await (0,l.aO)(e),a()}catch(e){console.error("Delete chat failed:",e),o(i)}}};if(!e)return(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center text-sm text-[var(--text-muted)] bg-[var(--bg)] border border-[var(--border)] rounded-xl",children:"Select a chat from the left to start messaging."});let K="dots"===C?"chat-bg":"gradient"===C?"bg-gradient-to-br from-slate-900 via-slate-950 to-emerald-900":"bg-[#111B21]";return(0,r.jsxs)("div",{className:"flex-1 flex flex-col rounded-xl overflow-hidden ".concat(K),children:[(0,r.jsxs)("header",{className:"h-14 flex items-center justify-between px-4 border-b border-[var(--border)] bg-[var(--surface)]/90 backdrop-blur",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"h-10 w-10 rounded-full bg-gradient-to-br from-purple-500 to-blue-600 flex items-center justify-center text-white font-bold shadow-md",children:(t||"U")[0].toUpperCase()}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"text-sm font-semibold text-[var(--text)]",children:[t||"Unknown",(0,r.jsxs)("span",{className:"text-xs text-[var(--text-muted)] ml-1",children:["(",e,")"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-[11px] text-emerald-400",children:[(0,r.jsxs)("span",{className:"relative flex h-2 w-2",children:[(0,r.jsx)("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"}),(0,r.jsx)("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-emerald-500"})]}),(0,r.jsxs)("span",{children:["online ",N&&"• Pinned"," ",k&&"• Archived"]})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,r.jsxs)("div",{className:"hidden md:flex items-center gap-1",children:[(0,r.jsx)(x.Z,{size:14,className:"text-[var(--text-muted)]"}),(0,r.jsxs)("select",{value:C,onChange:e=>_(e.target.value),className:"bg-[var(--surface)] border border-[var(--border)] text-[10px] px-2 py-1 rounded-lg text-[var(--text)]",children:[(0,r.jsx)("option",{value:"dots",children:"Dots"}),(0,r.jsx)("option",{value:"gradient",children:"Gradient"}),(0,r.jsx)("option",{value:"solid",children:"Solid"})]})]}),(0,r.jsxs)("button",{onClick:()=>S(e=>!e),className:"p-1 rounded-lg border text-[10px] flex items-center gap-1 ".concat(N?"border-yellow-500 text-yellow-400 bg-yellow-500/10":"border-[var(--border)] text-[var(--text-muted)] hover:bg-[var(--bg)]"),children:[(0,r.jsx)(m.Z,{size:12})," ",N?"Pinned":"Pin"]}),(0,r.jsxs)("button",{onClick:()=>D(e=>!e),className:"p-1 rounded-lg border text-[10px] flex items-center gap-1 ".concat(k?"border-blue-500 text-blue-400 bg-blue-500/10":"border-[var(--border)] text-[var(--text-muted)] hover:bg-[var(--bg)]"),children:[(0,r.jsx)(h.Z,{size:12})," ",k?"Archived":"Archive"]}),(0,r.jsx)("button",{onClick:a,className:"text-xs px-3 py-1 rounded-lg border border-red-500 text-red-500 hover:bg-red-500 hover:text-white transition",children:"Close"}),(0,r.jsx)("button",{onClick:q,className:"text-xs px-3 py-1 rounded-lg border border-red-600 text-red-600 hover:bg-red-600 hover:text-white transition",title:"Delete entire chat",children:"Delete Chat"})]})]}),(0,r.jsxs)("div",{className:"px-4 py-2 border-b border-[var(--border)] bg-[var(--surface)]/60 flex items-center gap-2 text-xs",children:[(0,r.jsx)(f.Z,{size:14,className:"text-[var(--text-muted)]"}),(0,r.jsx)("input",{value:R,onChange:e=>U(e.target.value),placeholder:"Search in this chat…",className:"flex-1 bg-transparent text-[var(--text)] placeholder:text-[var(--text-muted)] text-xs focus:outline-none"}),R&&(0,r.jsx)("button",{onClick:()=>U(""),className:"text-[10px] text-[var(--text-muted)] hover:text-[var(--text)]",children:"Clear"})]}),g&&(0,r.jsxs)("div",{className:"px-4 py-1 text-xs text-emerald-400 flex items-center gap-2",children:[t," is typing…",(0,r.jsxs)("span",{className:"flex gap-1",children:[(0,r.jsx)("span",{className:"w-2 h-2 bg-emerald-400 rounded-full animate-bounce"}),(0,r.jsx)("span",{className:"w-2 h-2 bg-emerald-400 rounded-full animate-bounce delay-150"}),(0,r.jsx)("span",{className:"w-2 h-2 bg-emerald-400 rounded-full animate-bounce delay-300"})]})]}),(0,r.jsxs)("div",{className:"relative flex-1",children:[(0,r.jsxs)("div",{ref:z,onScroll:e=>{let{scrollTop:t,scrollHeight:a,clientHeight:r}=e.currentTarget,n=a-(t+r)<40;T(n),n&&A(!1)},className:"absolute inset-0 overflow-y-auto px-4 py-3",children:[i.map((e,a)=>{let n="business"===e.from,s=M(e.createdAt),l=a>0?M(i[a-1].createdAt):null,o=e.replyToId?i.find(t=>t._id===e.replyToId):void 0,c=!!R&&(e.text||"").toLowerCase().includes(R.toLowerCase());return(0,r.jsxs)("div",{className:"mb-2",children:[s!==l&&(0,r.jsx)("div",{className:"text-center my-4",children:(0,r.jsx)("span",{className:"bg-gray-300 dark:bg-gray-700 text-gray-700 dark:text-gray-200 text-xs px-3 py-1 rounded-full",children:s})}),(0,r.jsx)("div",{className:"flex ".concat(n?"justify-end":"justify-start"),children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"max-w-[70%] rounded-2xl px-3 py-2 text-sm shadow-sm ".concat(n?"bg-emerald-500 text-white rounded-br-sm":"bg-[var(--surface)] text-[var(--text)] rounded-bl-sm"," ").concat(c?"ring-2 ring-yellow-300/70":""),title:Z(e),children:e.isDeleted?(0,r.jsx)("div",{className:"italic text-gray-400",children:"This message was deleted"}):e.deletedForMe?(0,r.jsx)("div",{className:"italic text-gray-400",children:"Deleted for me"}):(0,r.jsxs)(r.Fragment,{children:[o&&(0,r.jsxs)("div",{className:"border-l-2 border-white/40 pl-2 mb-1 text-[11px] opacity-80",children:[(0,r.jsx)("p",{className:"font-semibold",children:"business"===o.from?"You":t}),(0,r.jsx)("p",{className:"truncate max-w-[180px]",children:o.text||o.fileName||"[media]"})]}),"image"===e.fileType&&e.fileUrl&&(0,r.jsx)("img",{src:e.fileUrl,className:"w-40 rounded-lg mb-1 border border-white/20",alt:"sent"}),"document"===e.fileType&&(0,r.jsxs)("div",{className:"flex items-center gap-2 bg-black/10 dark:bg-white/10 p-2 rounded-lg mb-1 text-xs",children:["\uD83D\uDCC4 ",(0,r.jsx)("span",{className:"truncate",children:e.fileName})]}),"audio"===e.fileType&&e.fileUrl&&(0,r.jsx)("div",{className:"mb-1",children:(0,r.jsx)("audio",{controls:!0,className:"w-48",children:(0,r.jsx)("source",{src:e.fileUrl})})}),e.text&&(0,r.jsx)("p",{className:"whitespace-pre-wrap break-words",children:e.text}),(0,r.jsxs)("div",{className:"flex items-center justify-end gap-1 mt-1 text-[10px] opacity-80",children:[(0,r.jsx)("span",{children:new Date(e.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),n&&F(e.status)]}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-1 text-[11px] opacity-80",children:[(0,r.jsx)("button",{className:"hover:opacity-100 hover:underline",onClick:()=>w(e),children:"↩ Reply"}),(0,r.jsx)("div",{className:"flex gap-1",children:v.map(t=>(0,r.jsx)("button",{onClick:()=>J(e._id,t),className:"hover:scale-110 transition",children:t},t))})]}),e.reactions&&e.reactions.length>0&&(0,r.jsx)("div",{className:"mt-1 flex justify-end",children:(0,r.jsx)("div",{className:"bg-black/10 dark:bg-white/10 rounded-full px-2 py-[2px] text-[11px]",children:e.reactions.map(e=>(0,r.jsx)("span",{className:"mr-1",children:e},e))})})]})}),(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),I(O===e._id?null:e._id)},className:"absolute -top-1 right-0 p-1 rounded hover:bg-[var(--bg)]",title:"Message actions",children:(0,r.jsx)(p.Z,{size:14})}),O===e._id&&(0,r.jsxs)("div",{className:"absolute right-0 mt-8 w-44 bg-[var(--surface)] border border-[var(--border)] rounded shadow-md z-20",onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("button",{className:"w-full text-left px-3 py-2 hover:bg-[var(--bg)]",onClick:()=>{w(e),I(null)},children:"Reply"}),(0,r.jsx)("button",{className:"w-full text-left px-3 py-2 hover:bg-[var(--bg)]",onClick:()=>Y(e._id),children:"Delete for Me"}),(0,r.jsx)("button",{className:"w-full text-left px-3 py-2 text-red-600 hover:bg-red-50",onClick:()=>H(e._id),children:"Delete for Everyone"}),(0,r.jsx)("button",{className:"w-full text-left px-3 py-2 text-sm text-[var(--text-muted)] hover:bg-[var(--bg)]",onClick:()=>I(null),children:"Cancel"})]})]})})]},e._id)}),(0,r.jsx)("div",{ref:L})]}),P&&(0,r.jsxs)("button",{onClick:()=>{var e;T(!0),null===(e=L.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},className:"absolute bottom-4 right-4 flex items-center gap-1 px-3 py-1.5 rounded-full bg-[var(--surface)] border border-[var(--border)] text-[10px] text-[var(--text)] shadow-lg hover:bg-[var(--surface-alt)]",children:["New messages",(0,r.jsx)(b.Z,{size:12})]})]}),(0,r.jsx)(u,{onSend:B,onSendFile:V,disabled:c,onTyping:()=>y(!0),onStopTyping:()=>y(!1),replyTo:j?{id:j._id,text:j.text||j.fileName||"",from:j.from}:null,onCancelReply:()=>w(null)})]})}},32355:function(e,t,a){a.d(t,{BJ:function(){return u},Bv:function(){return l},PZ:function(){return d},RH:function(){return f},Vu:function(){return n},a3:function(){return o},aO:function(){return i},e8:function(){return c},fn:function(){return h},ij:function(){return m},pq:function(){return s},u6:function(){return p},wR:function(){return x}});let r="https://whatsapp-business-dashboard.onrender.com/api";async function n(e){let t=await fetch("".concat(r,"/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("Login failed");return t.json()}async function s(e,t){let a=await fetch("".concat(r,"/chats/").concat(e,"/messages/").concat(t,"/deleteForMe"),{method:"DELETE"});if(!a.ok)throw Error(await a.text());return a.json()}async function l(e,t){let a=await fetch("".concat(r,"/chats/").concat(e,"/messages/").concat(t,"/deleteForEveryone"),{method:"DELETE"});if(!a.ok)throw Error(await a.text());return a.json()}async function i(e){let t=await fetch("".concat(r,"/chats/").concat(e),{method:"DELETE"});if(!t.ok)throw Error(await t.text());return t.json()}async function o(){try{let e=await d(),t=new Set;return e.forEach(e=>{Array.isArray(e.tags)&&e.tags.forEach(e=>t.add(e))}),t.size?[...t]:["New","VIP","Lead","Returning"]}catch(e){return["New","VIP","Lead","Returning"]}}async function c(){let e=await fetch("".concat(r,"/templates"));if(!e.ok)throw Error(await e.text());return e.json()}async function d(){let e=await fetch("".concat(r,"/contacts"));if(!e.ok)throw Error(await e.text());return e.json()}async function u(e){let t=await fetch("".concat(r,"/chats/").concat(e,"/messages"));if(!t.ok)throw Error(await t.text());return t.json()}async function x(e,t){let a=await fetch("".concat(r,"/chats/").concat(e,"/messages"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:t,from:"business"})});if(!a.ok)throw Error(await a.text());return a.json()}async function m(e,t){let a=new FormData;a.append("phone",e),a.append("file",t);let n=await fetch("".concat(r,"/chats/upload-file"),{method:"POST",body:a});if(!n.ok)throw Error(await n.text());return n.json()}async function h(){let e=await fetch("".concat(r,"/campaigns"));if(!e.ok)throw Error(await e.text());return e.json()}async function f(e){let t=await fetch("".concat(r,"/campaigns"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error(await t.text());return t.json()}async function p(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Today",t=await fetch("".concat(r,"/analytics/dashboard?range=").concat(e));if(!t.ok)throw Error(await t.text());return t.json()}},58787:function(e,t,a){a.d(t,{a:function(){return s}});var r=a(22020),n=a(65249);let s=(0,r.Ue)()((0,n.tJ)((e,t)=>({selectedPhone:null,selectedName:null,chats:[{phone_number:"9876543210",name:"John Doe",last_message:"Hi, I want to know more!",last_time:"10:01 AM",unread:2},{phone_number:"9988776655",name:"Priya Sharma",last_message:"Thanks for the info!",last_time:"Yesterday",unread:0},{phone_number:"9123456780",name:"Rahul Kumar",last_message:"Sure, I’ll check.",last_time:"Monday",unread:1}],addChat:a=>{let r=t().chats;r.some(e=>e.phone_number===a.phone_number)||e({chats:[...r,a]})},setChats:t=>e({chats:t}),updateChatPreview:(t,a,r)=>e(e=>({chats:e.chats.map(n=>n.phone_number===t?{...n,last_message:a,last_time:r,unread:e.selectedPhone===t?0:n.unread+1}:n)})),updateChatName:(t,a)=>e(e=>({chats:e.chats.map(e=>e.phone_number===t?{...e,name:a}:e),selectedName:e.selectedPhone===t?a:e.selectedName})),markAsRead:t=>e(e=>({chats:e.chats.map(e=>e.phone_number===t?{...e,unread:0}:e)})),setSelectedChat:(t,a)=>{if(!t||""===t.trim()){console.error("❌ ERROR: setSelectedChat called with EMPTY phone");return}e({selectedPhone:t,selectedName:a||"Unknown"})},deleteChatByPhone:t=>e(e=>({chats:e.chats.filter(e=>e.phone_number!==t),selectedPhone:e.selectedPhone===t?null:e.selectedPhone,selectedName:e.selectedPhone===t?null:e.selectedName})),clearChat:()=>e({selectedPhone:null,selectedName:null})}),{name:"wa-chats"}))}}]);