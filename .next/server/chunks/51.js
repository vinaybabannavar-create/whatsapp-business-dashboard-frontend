"use strict";exports.id=51,exports.ids=[51],exports.modules={30051:(e,t,a)=>{a.d(t,{Z:()=>y});var r=a(95344),s=a(3729),l=a(67898),i=a(94287),n=a(14513),d=a(97075);let o=(0,d.Z)("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]]),c=(0,d.Z)("mic",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]]),x=(0,d.Z)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);function u({onSend:e,onSendFile:t,disabled:a,onTyping:l,onStopTyping:i,replyTo:d,onCancelReply:u}){let[m,h]=(0,s.useState)(""),p=(0,s.useRef)(null),b=()=>{m.trim()&&(e(m),h(""),i())};return(0,r.jsxs)("div",{className:"border-t bg-white p-3",children:[d&&(0,r.jsxs)("div",{className:"mb-2 p-2 bg-gray-100 border-l-4 border-emerald-500 rounded",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsxs)("p",{className:"text-xs font-semibold",children:["Replying to: ","business"===d.from?"You":"Customer"]}),r.jsx("button",{onClick:u,children:r.jsx(n.Z,{size:16})})]}),r.jsx("p",{className:"text-xs opacity-70 truncate max-w-[250px]",children:d.text||"[media]"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[r.jsx("button",{onClick:()=>p.current?.click(),className:"p-2 rounded-full hover:bg-gray-200 transition",children:r.jsx(o,{size:20})}),r.jsx("input",{type:"file",ref:p,hidden:!0,onChange:e=>{let a=e.target.files?.[0];a&&(t(a),e.target.value="")}}),r.jsx("input",{value:m,onKeyDown:e=>{"Enter"===e.key&&m.trim()&&(e.preventDefault(),b())},onChange:e=>{let t=e.target.value;h(t),t.trim().length>0?l():i()},placeholder:"Message...",className:"flex-1 px-4 py-2 bg-gray-100 rounded-full outline-none"}),r.jsx("button",{className:"p-2 rounded-full hover:bg-gray-200 transition",children:r.jsx(c,{size:20})}),r.jsx("button",{onClick:b,disabled:!m.trim()||a,className:`px-4 py-2 rounded-full flex items-center gap-2 font-medium shadow-sm transition ${m.trim()?"bg-emerald-500 hover:bg-emerald-600 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:r.jsx(x,{size:16})})]})]})}let m=(0,d.Z)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),h=(0,d.Z)("pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]),p=(0,d.Z)("archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);var b=a(28765);let f=(0,d.Z)("ellipsis-vertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),g=(0,d.Z)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),v=["❤️","\uD83D\uDE02","\uD83D\uDC4D","\uD83D\uDD25","\uD83D\uDE22"];function y(){let{selectedPhone:e,selectedName:t,clearChat:a}=(0,l.a)(),[n,d]=(0,s.useState)([]),[o,c]=(0,s.useState)(!1),[x,y]=(0,s.useState)(!1),[j,N]=(0,s.useState)(null),[w,k]=(0,s.useState)(!1),[D,S]=(0,s.useState)(!1),[C,_]=(0,s.useState)("dots"),[A,T]=(0,s.useState)(!0),[U,M]=(0,s.useState)(!1),[z,I]=(0,s.useState)(""),[Z,R]=(0,s.useState)(null),L=(0,s.useRef)(null),$=(0,s.useRef)(null);function F(e){let t=new Date(e),a=new Date;a.setHours(0,0,0,0),t.setHours(0,0,0,0);let r=(a.getTime()-t.getTime())/864e5;return 0===r?"Today":1===r?"Yesterday":r<7?t.toLocaleDateString("en-US",{weekday:"long"}):t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}let O=e=>{let t=new Date(e.createdAt).toLocaleString();return`Status: ${e.status??"sent"} • ${t}`};(0,s.useEffect)(()=>{(async function(){if(!e){d([]);return}c(!0);try{let t=(await (0,i.BJ)(e)||[]).map(e=>({...e,_id:e._id??e.id??String(Math.random()).slice(2),createdAt:"string"==typeof e.createdAt?e.createdAt:"string"==typeof e.time?e.time:new Date().toISOString(),reactions:Array.isArray(e.reactions)?e.reactions:[],deletedForMe:e.deletedForMe??!1,isDeleted:e.isDeleted??!1}));d(t)}catch(e){console.error("Failed to load chat history:",e),d([])}c(!1),N(null),T(!0),M(!1)})()},[e]),(0,s.useEffect)(()=>{A?(L.current?.scrollIntoView({behavior:"smooth"}),M(!1)):n.length>0&&M(!0)},[n,A]);let E=e=>e?"sent"===e?r.jsx("span",{className:"text-[10px] text-slate-200",children:"✓"}):"delivered"===e?r.jsx("span",{className:"text-[10px] text-slate-200",children:"✓✓"}):r.jsx("span",{className:"text-[10px] text-emerald-300 font-bold",children:"✓✓"}):null,P=(e,t)=>{d(a=>a.map(a=>a._id===e?{...a,reactions:a.reactions?.includes(t)?a.reactions.filter(e=>e!==t):[...a.reactions||[],t]}:a))},V=async t=>{if(!e)return;let a=Date.now().toString(),r={_id:a,from:"business",text:t,createdAt:new Date().toISOString(),status:"sent",replyToId:j?._id??null};d(e=>[...e,r]),N(null);try{let r=await (0,i.wR)(e,t),s=r._id??r.id??a,l=r.createdAt??r.time??new Date().toISOString();d(e=>e.map(e=>e._id===a?{...e,_id:s,createdAt:l,text:r.text??e.text,status:r.status??e.status}:e))}catch(e){console.error("Send failed:",e)}},B=async t=>{if(!e)return;let a=Date.now().toString(),r=t.type.startsWith("image")?"image":t.type.startsWith("audio")?"audio":"document",s=URL.createObjectURL(t),l={_id:a,from:"business",text:"",createdAt:new Date().toISOString(),status:"sent",fileUrl:s,fileName:t.name,fileType:r,replyToId:j?._id??null};d(e=>[...e,l]),N(null);try{let r=await (0,i.ij)(e,t),s=r._id??r.id??a,l=r.createdAt??r.time??new Date().toISOString();d(e=>e.map(e=>e._id===a?{...e,_id:s,createdAt:l,fileUrl:r.fileUrl??e.fileUrl,fileName:r.fileName??e.fileName,fileType:r.fileType??e.fileType,status:r.status??e.status}:e))}catch(e){console.error("File upload failed:",e)}},H=async t=>{if(e){d(e=>e.map(e=>e._id===t?{...e,deletedForMe:!0,text:"",fileUrl:void 0}:e)),R(null);try{await (0,i.pq)(e,t)}catch(e){console.error("Delete for me failed:",e)}}},Y=async t=>{if(e){d(e=>e.map(e=>e._id===t?{...e,isDeleted:!0,text:"",fileUrl:void 0,fileName:void 0,fileType:void 0}:e)),R(null);try{await (0,i.Bv)(e,t)}catch(e){console.error("Delete for everyone failed:",e)}}},q=async()=>{if(e){d([]);try{await (0,i.aO)(e),a()}catch(e){console.error("Delete chat failed:",e),d(n)}}};if(!e)return r.jsx("div",{className:"flex-1 flex items-center justify-center text-sm text-[var(--text-muted)] bg-[var(--bg)] border border-[var(--border)] rounded-xl",children:"Select a chat from the left to start messaging."});let W="dots"===C?"chat-bg":"gradient"===C?"bg-gradient-to-br from-slate-900 via-slate-950 to-emerald-900":"bg-[#111B21]";return(0,r.jsxs)("div",{className:`flex-1 flex flex-col rounded-xl overflow-hidden ${W}`,children:[(0,r.jsxs)("header",{className:"h-14 flex items-center justify-between px-4 border-b border-[var(--border)] bg-[var(--surface)]/90 backdrop-blur",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"h-10 w-10 rounded-full bg-gradient-to-br from-purple-500 to-blue-600 flex items-center justify-center text-white font-bold shadow-md",children:(t||"U")[0].toUpperCase()}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"text-sm font-semibold text-[var(--text)]",children:[t||"Unknown",(0,r.jsxs)("span",{className:"text-xs text-[var(--text-muted)] ml-1",children:["(",e,")"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-[11px] text-emerald-400",children:[(0,r.jsxs)("span",{className:"relative flex h-2 w-2",children:[r.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"}),r.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-emerald-500"})]}),(0,r.jsxs)("span",{children:["online ",w&&"• Pinned"," ",D&&"• Archived"]})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,r.jsxs)("div",{className:"hidden md:flex items-center gap-1",children:[r.jsx(m,{size:14,className:"text-[var(--text-muted)]"}),(0,r.jsxs)("select",{value:C,onChange:e=>_(e.target.value),className:"bg-[var(--surface)] border border-[var(--border)] text-[10px] px-2 py-1 rounded-lg text-[var(--text)]",children:[r.jsx("option",{value:"dots",children:"Dots"}),r.jsx("option",{value:"gradient",children:"Gradient"}),r.jsx("option",{value:"solid",children:"Solid"})]})]}),(0,r.jsxs)("button",{onClick:()=>k(e=>!e),className:`p-1 rounded-lg border text-[10px] flex items-center gap-1 ${w?"border-yellow-500 text-yellow-400 bg-yellow-500/10":"border-[var(--border)] text-[var(--text-muted)] hover:bg-[var(--bg)]"}`,children:[r.jsx(h,{size:12})," ",w?"Pinned":"Pin"]}),(0,r.jsxs)("button",{onClick:()=>S(e=>!e),className:`p-1 rounded-lg border text-[10px] flex items-center gap-1 ${D?"border-blue-500 text-blue-400 bg-blue-500/10":"border-[var(--border)] text-[var(--text-muted)] hover:bg-[var(--bg)]"}`,children:[r.jsx(p,{size:12})," ",D?"Archived":"Archive"]}),r.jsx("button",{onClick:a,className:"text-xs px-3 py-1 rounded-lg border border-red-500 text-red-500 hover:bg-red-500 hover:text-white transition",children:"Close"}),r.jsx("button",{onClick:q,className:"text-xs px-3 py-1 rounded-lg border border-red-600 text-red-600 hover:bg-red-600 hover:text-white transition",title:"Delete entire chat",children:"Delete Chat"})]})]}),(0,r.jsxs)("div",{className:"px-4 py-2 border-b border-[var(--border)] bg-[var(--surface)]/60 flex items-center gap-2 text-xs",children:[r.jsx(b.Z,{size:14,className:"text-[var(--text-muted)]"}),r.jsx("input",{value:z,onChange:e=>I(e.target.value),placeholder:"Search in this chat…",className:"flex-1 bg-transparent text-[var(--text)] placeholder:text-[var(--text-muted)] text-xs focus:outline-none"}),z&&r.jsx("button",{onClick:()=>I(""),className:"text-[10px] text-[var(--text-muted)] hover:text-[var(--text)]",children:"Clear"})]}),x&&(0,r.jsxs)("div",{className:"px-4 py-1 text-xs text-emerald-400 flex items-center gap-2",children:[t," is typing…",(0,r.jsxs)("span",{className:"flex gap-1",children:[r.jsx("span",{className:"w-2 h-2 bg-emerald-400 rounded-full animate-bounce"}),r.jsx("span",{className:"w-2 h-2 bg-emerald-400 rounded-full animate-bounce delay-150"}),r.jsx("span",{className:"w-2 h-2 bg-emerald-400 rounded-full animate-bounce delay-300"})]})]}),(0,r.jsxs)("div",{className:"relative flex-1",children:[(0,r.jsxs)("div",{ref:$,onScroll:e=>{let{scrollTop:t,scrollHeight:a,clientHeight:r}=e.currentTarget,s=a-(t+r)<40;T(s),s&&M(!1)},className:"absolute inset-0 overflow-y-auto px-4 py-3",children:[n.map((e,a)=>{let s="business"===e.from,l=F(e.createdAt),i=a>0?F(n[a-1].createdAt):null,d=e.replyToId?n.find(t=>t._id===e.replyToId):void 0,o=!!z&&(e.text||"").toLowerCase().includes(z.toLowerCase());return(0,r.jsxs)("div",{className:"mb-2",children:[l!==i&&r.jsx("div",{className:"text-center my-4",children:r.jsx("span",{className:"bg-gray-300 dark:bg-gray-700 text-gray-700 dark:text-gray-200 text-xs px-3 py-1 rounded-full",children:l})}),r.jsx("div",{className:`flex ${s?"justify-end":"justify-start"}`,children:(0,r.jsxs)("div",{className:"relative",children:[r.jsx("div",{className:`max-w-[70%] rounded-2xl px-3 py-2 text-sm shadow-sm ${s?"bg-emerald-500 text-white rounded-br-sm":"bg-[var(--surface)] text-[var(--text)] rounded-bl-sm"} ${o?"ring-2 ring-yellow-300/70":""}`,title:O(e),children:e.isDeleted?r.jsx("div",{className:"italic text-gray-400",children:"This message was deleted"}):e.deletedForMe?r.jsx("div",{className:"italic text-gray-400",children:"Deleted for me"}):(0,r.jsxs)(r.Fragment,{children:[d&&(0,r.jsxs)("div",{className:"border-l-2 border-white/40 pl-2 mb-1 text-[11px] opacity-80",children:[r.jsx("p",{className:"font-semibold",children:"business"===d.from?"You":t}),r.jsx("p",{className:"truncate max-w-[180px]",children:d.text||d.fileName||"[media]"})]}),"image"===e.fileType&&e.fileUrl&&r.jsx("img",{src:e.fileUrl,className:"w-40 rounded-lg mb-1 border border-white/20",alt:"sent"}),"document"===e.fileType&&(0,r.jsxs)("div",{className:"flex items-center gap-2 bg-black/10 dark:bg-white/10 p-2 rounded-lg mb-1 text-xs",children:["\uD83D\uDCC4 ",r.jsx("span",{className:"truncate",children:e.fileName})]}),"audio"===e.fileType&&e.fileUrl&&r.jsx("div",{className:"mb-1",children:r.jsx("audio",{controls:!0,className:"w-48",children:r.jsx("source",{src:e.fileUrl})})}),e.text&&r.jsx("p",{className:"whitespace-pre-wrap break-words",children:e.text}),(0,r.jsxs)("div",{className:"flex items-center justify-end gap-1 mt-1 text-[10px] opacity-80",children:[r.jsx("span",{children:new Date(e.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),s&&E(e.status)]}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-1 text-[11px] opacity-80",children:[r.jsx("button",{className:"hover:opacity-100 hover:underline",onClick:()=>N(e),children:"↩ Reply"}),r.jsx("div",{className:"flex gap-1",children:v.map(t=>r.jsx("button",{onClick:()=>P(e._id,t),className:"hover:scale-110 transition",children:t},t))})]}),e.reactions&&e.reactions.length>0&&r.jsx("div",{className:"mt-1 flex justify-end",children:r.jsx("div",{className:"bg-black/10 dark:bg-white/10 rounded-full px-2 py-[2px] text-[11px]",children:e.reactions.map(e=>r.jsx("span",{className:"mr-1",children:e},e))})})]})}),r.jsx("button",{onClick:t=>{t.stopPropagation(),R(Z===e._id?null:e._id)},className:"absolute -top-1 right-0 p-1 rounded hover:bg-[var(--bg)]",title:"Message actions",children:r.jsx(f,{size:14})}),Z===e._id&&(0,r.jsxs)("div",{className:"absolute right-0 mt-8 w-44 bg-[var(--surface)] border border-[var(--border)] rounded shadow-md z-20",onClick:e=>e.stopPropagation(),children:[r.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-[var(--bg)]",onClick:()=>{N(e),R(null)},children:"Reply"}),r.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-[var(--bg)]",onClick:()=>H(e._id),children:"Delete for Me"}),r.jsx("button",{className:"w-full text-left px-3 py-2 text-red-600 hover:bg-red-50",onClick:()=>Y(e._id),children:"Delete for Everyone"}),r.jsx("button",{className:"w-full text-left px-3 py-2 text-sm text-[var(--text-muted)] hover:bg-[var(--bg)]",onClick:()=>R(null),children:"Cancel"})]})]})})]},e._id)}),r.jsx("div",{ref:L})]}),U&&(0,r.jsxs)("button",{onClick:()=>{T(!0),L.current?.scrollIntoView({behavior:"smooth"})},className:"absolute bottom-4 right-4 flex items-center gap-1 px-3 py-1.5 rounded-full bg-[var(--surface)] border border-[var(--border)] text-[10px] text-[var(--text)] shadow-lg hover:bg-[var(--surface-alt)]",children:["New messages",r.jsx(g,{size:12})]})]}),r.jsx(u,{onSend:V,onSendFile:B,disabled:o,onTyping:()=>y(!0),onStopTyping:()=>y(!1),replyTo:j?{id:j._id,text:j.text||j.fileName||"",from:j.from}:null,onCancelReply:()=>N(null)})]})}}};