"use strict";exports.id=51,exports.ids=[51],exports.modules={30051:(e,t,s)=>{s.d(t,{Z:()=>y});var a=s(95344),l=s(3729),r=s(67898),i=s(94287),n=s(14513),d=s(97075);let o=(0,d.Z)("paperclip",[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]]),c=(0,d.Z)("mic",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]]),x=(0,d.Z)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);function m({onSend:e,onSendFile:t,disabled:s,onTyping:r,onStopTyping:i,replyTo:d,onCancelReply:m}){let[u,h]=(0,l.useState)(""),p=(0,l.useRef)(null);return(0,a.jsxs)("div",{className:"border-t bg-white p-3",children:[d&&(0,a.jsxs)("div",{className:"mb-2 p-2 bg-gray-100 border-l-4 border-emerald-500 rounded",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("p",{className:"text-xs font-semibold",children:["Replying to: ","business"===d.from?"You":"Customer"]}),a.jsx("button",{onClick:m,children:a.jsx(n.Z,{size:16})})]}),a.jsx("p",{className:"text-xs opacity-70 truncate max-w-[250px]",children:d.text||"[media]"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx("button",{onClick:()=>p.current?.click(),className:"p-2 rounded-full hover:bg-gray-200 transition",children:a.jsx(o,{size:20})}),a.jsx("input",{type:"file",ref:p,hidden:!0,onChange:e=>{e.target.files?.length&&t(e.target.files[0])}}),a.jsx("input",{value:u,onChange:e=>{h(e.target.value),e.target.value?r():i()},placeholder:"Message...",className:"flex-1 px-4 py-2 bg-gray-100 rounded-full outline-none"}),a.jsx("button",{className:"p-2 rounded-full hover:bg-gray-200 transition",children:a.jsx(c,{size:20})}),a.jsx("button",{onClick:()=>{u.trim()&&(e(u),h(""))},disabled:!u.trim()||s,className:`
            px-4 py-2 rounded-full flex items-center gap-2 font-medium shadow-sm
            transition
            ${u.trim()?"bg-emerald-500 hover:bg-emerald-600 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}
          `,children:a.jsx(x,{size:16})})]})]})}let u=(0,d.Z)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),h=(0,d.Z)("pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]),p=(0,d.Z)("archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);var b=s(28765);let f=(0,d.Z)("ellipsis-vertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),g=(0,d.Z)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),v=["❤️","\uD83D\uDE02","\uD83D\uDC4D","\uD83D\uDD25","\uD83D\uDE22"];function y(){let{selectedPhone:e,selectedName:t,clearChat:s}=(0,r.a)(),[n,d]=(0,l.useState)([]),[o,c]=(0,l.useState)(!1),[x,y]=(0,l.useState)(!1),[j,N]=(0,l.useState)(null),[w,k]=(0,l.useState)(!1),[D,S]=(0,l.useState)(!1),[C,T]=(0,l.useState)("dots"),[U,z]=(0,l.useState)(!0),[M,Z]=(0,l.useState)(!1),[I,R]=(0,l.useState)(""),[L,$]=(0,l.useState)(null),F=(0,l.useRef)(null),A=(0,l.useRef)(null);function O(e){let t=new Date(e),s=new Date;s.setHours(0,0,0,0),t.setHours(0,0,0,0);let a=(s.getTime()-t.getTime())/864e5;return 0===a?"Today":1===a?"Yesterday":a<7?t.toLocaleDateString("en-US",{weekday:"long"}):t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}(0,l.useEffect)(()=>{(async function(){if(!e){d([]);return}c(!0),d((await (0,i.BJ)(e)).map(e=>({...e,time:e.time&&"string"==typeof e.time?e.time.includes("T")?e.time:new Date(e.time).toISOString():new Date().toISOString(),deletedForMe:e.deletedForMe??!1,isDeleted:e.isDeleted??!1}))),c(!1),N(null),z(!0),Z(!1)})()},[e]),(0,l.useEffect)(()=>{U?(F.current?.scrollIntoView({behavior:"smooth"}),Z(!1)):n.length>0&&Z(!0)},[n,U]);let B=e=>e?"sent"===e?a.jsx("span",{className:"text-[10px] text-slate-200",children:"✓"}):"delivered"===e?a.jsx("span",{className:"text-[10px] text-slate-200",children:"✓✓"}):a.jsx("span",{className:"text-[10px] text-emerald-300 font-bold",children:"✓✓"}):null,E=(e,t)=>{d(s=>s.map(s=>s.id===e?{...s,reactions:s.reactions?.includes(t)?s.reactions.filter(e=>e!==t):[...s.reactions||[],t]}:s))},P=async t=>{if(!e){console.error("❌ Cannot send message: no phone selected");return}let s=Date.now().toString(),a={id:s,from:"business",text:t,time:new Date().toISOString(),status:"sent",replyToId:j?.id??null};d(e=>[...e,a]),N(null);let l=await (0,i.wR)(e,t);d(e=>e.map(e=>e.id===s?{...e,id:l.id,time:l.time,text:l.text,status:l.status}:e))},V=async t=>{if(!e){console.error("❌ Cannot send message: no phone selected");return}let s=Date.now().toString(),a=t.type.startsWith("image")?"image":t.type.startsWith("audio")?"audio":"document",l=URL.createObjectURL(t),r={id:s,from:"business",text:"",time:new Date().toISOString(),status:"sent",fileUrl:l,fileName:t.name,fileType:a,replyToId:j?.id??null};d(e=>[...e,r]),N(null);try{let a=await (0,i.ij)(e,t);d(e=>e.map(e=>e.id===s?{...e,id:a.id??e.id,time:a.time??e.time,fileUrl:a.fileUrl??e.fileUrl,fileName:a.fileName??e.fileName,fileType:a.fileType??e.fileType,status:a.status??e.status}:e))}catch(e){console.error("File upload failed:",e)}},H=async t=>{if(e){d(e=>e.map(e=>e.id===t?{...e,deletedForMe:!0,text:"",fileUrl:void 0}:e)),$(null);try{await (0,i.pq)(e,t)}catch(t){console.error("Delete for me failed:",t),d(await (0,i.BJ)(e))}}},J=async t=>{if(e){d(e=>e.map(e=>e.id===t?{...e,isDeleted:!0,text:"",fileUrl:void 0,fileName:void 0,fileType:void 0}:e)),$(null);try{await (0,i.Bv)(e,t)}catch(t){console.error("Delete for everyone failed:",t),d(await (0,i.BJ)(e))}}},Y=async()=>{if(e){d([]);try{await (0,i.aO)(e),s()}catch(e){console.error("Delete chat failed:",e),d(n)}}};if(!e)return a.jsx("div",{className:"flex-1 flex items-center justify-center text-sm text-[var(--text-muted)] bg-[var(--bg)] rounded-xl border border-[var(--border)]",children:"Select a chat from the left to start messaging."});let q="dots"===C?"chat-bg":"gradient"===C?"bg-gradient-to-br from-slate-900 via-slate-950 to-emerald-900":"bg-[#111B21]",W=e=>{let t=new Date(e.time).toLocaleString();return`Status: ${e.status??"sent"} • ${t}`};return(0,a.jsxs)("div",{className:`flex-1 flex flex-col rounded-xl overflow-hidden ${q}`,children:[(0,a.jsxs)("header",{className:"h-14 flex items-center justify-between px-4 border-b border-[var(--border)] bg-[var(--surface)]/90 backdrop-blur",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"h-10 w-10 rounded-full bg-gradient-to-br from-purple-500 to-blue-600 flex items-center justify-center text-white font-bold shadow-md",children:t?.charAt(0).toUpperCase()}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm font-semibold text-[var(--text)]",children:[t,(0,a.jsxs)("span",{className:"text-xs text-[var(--text-muted)] ml-1",children:["(",e,")"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-[11px] text-emerald-400",children:[(0,a.jsxs)("span",{className:"relative flex h-2 w-2",children:[a.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"}),a.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-emerald-500"})]}),(0,a.jsxs)("span",{children:["online ",w&&"• Pinned"," ",D&&"• Archived"]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,a.jsxs)("div",{className:"hidden md:flex items-center gap-1",children:[a.jsx(u,{size:14,className:"text-[var(--text-muted)]"}),(0,a.jsxs)("select",{value:C,onChange:e=>T(e.target.value),className:"bg-[var(--surface)] border border-[var(--border)] text-[10px] px-2 py-1 rounded-lg text-[var(--text)]",children:[a.jsx("option",{value:"dots",children:"Dots"}),a.jsx("option",{value:"gradient",children:"Gradient"}),a.jsx("option",{value:"solid",children:"Solid"})]})]}),(0,a.jsxs)("button",{onClick:()=>k(e=>!e),className:`p-1 rounded-lg border text-[10px] flex items-center gap-1 ${w?"border-yellow-500 text-yellow-400 bg-yellow-500/10":"border-[var(--border)] text-[var(--text-muted)] hover:bg-[var(--bg)]"}`,children:[a.jsx(h,{size:12})," ",w?"Pinned":"Pin"]}),(0,a.jsxs)("button",{onClick:()=>S(e=>!e),className:`p-1 rounded-lg border text-[10px] flex items-center gap-1 ${D?"border-blue-500 text-blue-400 bg-blue-500/10":"border-[var(--border)] text-[var(--text-muted)] hover:bg-[var(--bg)]"}`,children:[a.jsx(p,{size:12})," ",D?"Archived":"Archive"]}),a.jsx("button",{onClick:s,className:"text-xs px-3 py-1 rounded-lg border border-red-500 text-red-500 hover:bg-red-500 hover:text-white transition",children:"Close"}),a.jsx("button",{onClick:Y,className:"text-xs px-3 py-1 rounded-lg border border-red-600 text-red-600 hover:bg-red-600 hover:text-white transition",title:"Delete entire chat",children:"Delete Chat"})]})]}),(0,a.jsxs)("div",{className:"px-4 py-2 border-b border-[var(--border)] bg-[var(--surface)]/60 flex items-center gap-2 text-xs",children:[a.jsx(b.Z,{size:14,className:"text-[var(--text-muted)]"}),a.jsx("input",{value:I,onChange:e=>R(e.target.value),placeholder:"Search in this chat…",className:"flex-1 bg-transparent text-[var(--text)] placeholder:text-[var(--text-muted)] text-xs focus:outline-none"}),I&&a.jsx("button",{onClick:()=>R(""),className:"text-[10px] text-[var(--text-muted)] hover:text-[var(--text)]",children:"Clear"})]}),x&&(0,a.jsxs)("div",{className:"px-4 py-1 text-xs text-emerald-400 flex items-center gap-2",children:[t," is typing…",(0,a.jsxs)("span",{className:"flex gap-1",children:[a.jsx("span",{className:"w-2 h-2 bg-emerald-400 rounded-full animate-bounce"}),a.jsx("span",{className:"w-2 h-2 bg-emerald-400 rounded-full animate-bounce delay-150"}),a.jsx("span",{className:"w-2 h-2 bg-emerald-400 rounded-full animate-bounce delay-300"})]})]}),(0,a.jsxs)("div",{className:"relative flex-1",children:[(0,a.jsxs)("div",{ref:A,onScroll:e=>{let{scrollTop:t,scrollHeight:s,clientHeight:a}=e.currentTarget,l=s-(t+a)<40;z(l),l&&Z(!1)},className:"absolute inset-0 overflow-y-auto px-4 py-3",children:[n.map((e,s)=>{let l="business"===e.from,r=O(e.time),i=s>0?O(n[s-1].time):null,d=e.replyToId?n.find(t=>t.id===e.replyToId):void 0,o=!!I&&(e.text||"").toLowerCase().includes(I.toLowerCase());return(0,a.jsxs)("div",{className:"mb-2",children:[r!==i&&a.jsx("div",{className:"text-center my-4",children:a.jsx("span",{className:"bg-gray-300 dark:bg-gray-700 text-gray-700 dark:text-gray-200 text-xs px-3 py-1 rounded-full",children:r})}),a.jsx("div",{className:`flex ${l?"justify-end":"justify-start"}`,children:(0,a.jsxs)("div",{className:"relative",children:[" ",a.jsx("div",{className:`max-w-[70%] rounded-2xl px-3 py-2 text-sm shadow-sm ${l?"bg-emerald-500 text-white rounded-br-sm":"bg-[var(--surface)] text-[var(--text)] rounded-bl-sm"} ${o?"ring-2 ring-yellow-300/70":""}`,title:W(e),children:e.isDeleted?a.jsx("div",{className:"italic text-gray-400",children:"This message was deleted"}):e.deletedForMe?a.jsx("div",{className:"italic text-gray-400",children:"Deleted for me"}):(0,a.jsxs)(a.Fragment,{children:[d&&(0,a.jsxs)("div",{className:"border-l-2 border-white/40 dark:border-emerald-300/40 pl-2 mb-1 text-[11px] opacity-80",children:[a.jsx("p",{className:"font-semibold",children:"business"===d.from?"You":t}),a.jsx("p",{className:"truncate max-w-[180px]",children:d.text||d.fileName||"[media]"})]}),"image"===e.fileType&&e.fileUrl&&a.jsx("img",{src:e.fileUrl,className:"w-40 rounded-lg mb-1 border border-white/20",alt:"sent"}),"document"===e.fileType&&(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-black/10 dark:bg-white/10 p-2 rounded-lg mb-1 text-xs",children:["\uD83D\uDCC4 ",a.jsx("span",{className:"truncate",children:e.fileName})]}),"audio"===e.fileType&&e.fileUrl&&a.jsx("div",{className:"mb-1",children:a.jsx("audio",{controls:!0,className:"w-48",children:a.jsx("source",{src:e.fileUrl})})}),e.text&&a.jsx("p",{className:"whitespace-pre-wrap break-words",children:e.text}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-1 mt-1 text-[10px] opacity-80",children:[a.jsx("span",{children:new Date(e.time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),l&&B(e.status)]}),(0,a.jsxs)("div",{className:"flex justify-between items-center mt-1 text-[11px] opacity-80",children:[a.jsx("button",{className:"hover:opacity-100 hover:underline",onClick:()=>N(e),children:"↩ Reply"}),a.jsx("div",{className:"flex gap-1",children:v.map(t=>a.jsx("button",{onClick:()=>E(e.id,t),className:"hover:scale-110 transition",children:t},t))})]}),e.reactions&&e.reactions.length>0&&a.jsx("div",{className:"mt-1 flex justify-end",children:a.jsx("div",{className:"bg-black/10 dark:bg:white/10 rounded-full px-2 py-[2px] text-[11px]",children:e.reactions.map(e=>a.jsx("span",{className:"mr-1",children:e},e))})})]})}),a.jsx("button",{onClick:t=>{t.stopPropagation(),$(L===e.id?null:e.id)},className:"absolute -top-1 right-0 p-1 rounded hover:bg-[var(--bg)]",title:"Message actions",children:a.jsx(f,{size:14})}),L===e.id&&(0,a.jsxs)("div",{className:"absolute right-0 mt-8 w-44 bg-[var(--surface)] border border-[var(--border)] rounded shadow-md z-20",onClick:e=>e.stopPropagation(),children:[a.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-[var(--bg)]",onClick:()=>{N(e),$(null)},children:"Reply"}),a.jsx("button",{className:"w-full text-left px-3 py-2 hover:bg-[var(--bg)]",onClick:()=>{H(e.id)},children:"Delete for Me"}),a.jsx("button",{className:"w-full text-left px-3 py-2 text-red-600 hover:bg-red-50",onClick:()=>{J(e.id)},children:"Delete for Everyone"}),a.jsx("button",{className:"w-full text-left px-3 py-2 text-sm text-[var(--text-muted)] hover:bg-[var(--bg)]",onClick:()=>$(null),children:"Cancel"})]})]})})]},e.id)}),a.jsx("div",{ref:F})]}),M&&(0,a.jsxs)("button",{onClick:()=>{z(!0),F.current?.scrollIntoView({behavior:"smooth"})},className:" absolute bottom-4 right-4 flex items-center gap-1 px-3 py-1.5 rounded-full bg-[var(--surface)] border border-[var(--border)] text-[10px] text-[var(--text)] shadow-lg hover:bg-[var(--surface-alt)] ",children:["New messages",a.jsx(g,{size:12})]})]}),a.jsx(m,{onSend:P,onSendFile:V,disabled:o,onTyping:()=>y(!0),onStopTyping:()=>y(!1),replyTo:j?{id:j.id,text:j.text,from:j.from}:null,onCancelReply:()=>N(null)})]})}}};